#!/bin/bash

cat | while read file ; do 
	if file -i  $file | grep text > /dev/null ; then 
		labo=$(echo $file | sed 's/.*dir=//' | sed 's/%2F.*//'); 
		if head $file | grep $labo > /dev/null ; then 
			cat $file > $file.lab; 
		else 
			cat $file | sed "s/^/$labo\t/" > $file.lab ; 
		fi ;
		if file -i "$file.lab" | grep -i iso-8859-1 ; then
			recode ISO88591..UTF8 "$file.lab"
		fi
	fi ; 
done
