all: GILEAD.anon.csv GILEAD.personnesmorales.csv GSK.anon.csv OncologiePediatrie.anon.csv SANOFI.anon.csv AMGEN.anon.csv NOVARTIS_PHARMA.anon.csv ROCHE.anon.csv index.html

%.anon.csv: %.csv
	awk -F ',' '{print $$1","$$2","$$3","$$7","$$16","$$17","$$13","$$14","$$12","$$9","$$10","$$18","$$22}' $< > $@

GILEAD.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > GILEAD.csv
	grep ',GILEAD SCIENCES,' ../../data/all.unames.csv >> GILEAD.csv
	grep ',Gilead,' ../../data/all.unames.csv | sed 's/,Gilead,/,GILEAD SCIENCES,/' >> GILEAD.csv

GSK.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > GSK.csv
	grep ',GLAXOSMITHKLINE,' ../../data/all.unames.csv >> GSK.csv


GILEAD.personnesmorales.csv: GILEAD.csv
	echo "Nom personne morale,code postal,montant en euros,date,type" > GILEAD.personnesmorales.csv
	grep ',Asso' GILEAD.csv  | awk -F ',' '{print $$4","$$5","$$12","$$13 $$9","$$14 $$10}' >> GILEAD.personnesmorales.csv
	grep ',Autres types' GILEAD.csv  | awk -F ',' '{print $$4","$$5","$$12","$$13 $$9","$$14 $$10}' >> GILEAD.personnesmorales.csv 

SANOFI.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > SANOFI.csv
	grep ',SANOFI,' ../../data/all.unames.csv | grep CONVENTION >> SANOFI.csv

AMGEN.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > AMGEN.csv
	grep ',AMGEN,' ../../data/all.unames.csv | grep CONVENTION >> AMGEN.csv

NOVARTIS_PHARMA.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > NOVARTIS_PHARMA.csv
	grep ',NOVARTIS PHARMA,' ../../data/all.unames.csv | grep CONVENTION >> NOVARTIS_PHARMA.csv

ROCHE.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > ROCHE.csv
	grep ',ROCHE,' ../../data/all.unames.csv | grep CONVENTION >> ROCHE.csv

OncologiePediatrie.csv: ../../data/all.unames.csv
	head -n 1 ../../data/all.unames.csv > OncologiePediatrie.csv
	grep ,Oncologie, ../../data/all.unames.csv >> OncologiePediatrie.csv
	grep ,PÃ©diatrie, ../../data/all.unames.csv >> OncologiePediatrie.csv


index.html: capa.ipynb
	ipython nbconvert --to html  capa.ipynb 
	mv capa.html index.html
	sed -i 's|<title>capa</title>|<title>capa</title>\n <meta name="robots" content="noindex,nofollow" />|' index.html
	sed -i 's/div.input_area>div.highlight>pre{/div.input_area>div.highlight>pre{opacity: 0.3;/' index.html

clean:
	rm *csv
